<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <UsingTask TaskName="Avalux.OpenAi.Client.Tools.GenerateCodeTask"
               AssemblyFile="$(MSBuildThisFileDirectory)..\tasks\netstandard2.0\Avalux.OpenAi.Client.Tools.dll"/>

    <ItemGroup>
        <ProtocolFiles Include="**\*.yml" />
    </ItemGroup>

    <Target Name="GenerateAvaluxOpenAiClientCodeOnChange" BeforeTargets="SourceFilesProjectOutputGroup">
        <GenerateCodeTask
                ProtocolFiles="@(ProtocolFiles)"
                OutputDirectory="$(IntermediateOutputPath)" />

        <ItemGroup>
            <Compile Include="$(IntermediateOutputPath)*.generated.cs" />
        </ItemGroup>
    </Target>

    <Target Name="GenerateAvaluxOpenAiClientCodeOnCompile" BeforeTargets="CoreCompile">
        <GenerateCodeTask
                ProtocolFiles="@(ProtocolFiles)"
                OutputDirectory="$(IntermediateOutputPath)" />

        <ItemGroup>
            <Compile Include="$(IntermediateOutputPath)*.generated.cs" />
        </ItemGroup>
    </Target>
</Project>